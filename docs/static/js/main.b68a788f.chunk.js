(this["webpackJsonpsmart-house-itwin-viewer"]=this["webpackJsonpsmart-house-itwin-viewer"]||[]).push([[0],{1312:function(e,t,i){e.exports=i(2684)},1313:function(e,t,i){},1318:function(e,t,i){},1599:function(e,t){},1607:function(e,t){},1653:function(e,t){},1675:function(e,t){},1677:function(e,t){},1792:function(e,t){},1794:function(e,t){},2684:function(e,t,i){"use strict";i.r(t);i(1313);var a=i(0),n=i.n(a),o=i(36),r=i.n(o),s=(i(1318),i(1306)),c=i(249),l=i(7);class AuthorizationClient_AuthorizationClient{static get oidcClient(){return this._oidcClient}static async initializeOidc(){var e;if(this._oidcClient)return;const t={clientId:null!=="imodeljs-spa-samples-2686"?"imodeljs-spa-samples-2686":"",redirectUri:null!=="http://localhost:3000/signin-callback"?"http://localhost:3000/signin-callback":"",postSignoutRedirectUri:"http://localhost:3000/logout",scope:null!==(e="openid email profile organization imodelhub context-registry-service:read-only product-settings-service general-purpose-imodeljs-backend imodeljs-router urlps-third-party")?e:"",responseType:"code"};await c.BrowserAuthorizationCallbackHandler.handleSigninCallback(t.redirectUri),this._oidcClient=new c.BrowserAuthorizationClient(t)}static async signIn(){await this.oidcClient.signIn(new l.FrontendRequestContext)}static async signInSilent(){await this.oidcClient.signInSilent(new l.FrontendRequestContext)}static async signOut(){await this.oidcClient.signOut(new l.FrontendRequestContext)}}AuthorizationClient_AuthorizationClient._oidcClient=void 0;var d=AuthorizationClient_AuthorizationClient,u=i(3),m=i(382),g=i.n(m);const Header=({loggedIn:e,handleLogin:t,handleLogout:i})=>n.a.createElement("header",{className:g.a.header},n.a.createElement("div",{className:g.a.buttonContainer},n.a.createElement(u.Button,{className:g.a.button,onClick:t,buttonType:u.ButtonType.Primary,disabled:e},"Sign In"),n.a.createElement(u.Button,{className:g.a.button,onClick:i,buttonType:u.ButtonType.Primary,disabled:!e},"Sign Out")));class Visualization{}Visualization.hideHouseExterior=async(e,t)=>{const i=await Visualization.getCategoryIds(e.iModel);t?e.changeCategoryDisplay(i,t):e.changeCategoryDisplay(i,!1)},Visualization.getCategoryIds=async e=>{const t=`select ECInstanceId from bis.category WHERE Codevalue IN (${["'Wall 1st'","'Wall 2nd'","'Dry Wall 1st'","'Dry Wall 2nd'","'Brick Exterior'","'Windows 1st'","'Windows 2nd'","'Ceiling 1st'","'Ceiling 2nd'","'Callouts'","'Roof'","'light fixture'"].toString()});`,i=e.query(t),a=[];for await(const n of i)a.push(n.id);return a};var h=i(9);class SmartDeviceMarker_SmartDeviceMarker extends l.Marker{constructor(e,t,i,a,n,o){super(e,t),this.elementId=void 0,this._smartDeviceId=void 0,this._smartDeviceType=void 0,this.elementId=i,this._smartDeviceId=a,this._smartDeviceType=n,this.setImageUrl(`/${this._smartDeviceType}.png`),this.title=this.populateTitle(o)}populateTitle(e){const t=document.createElement("div");let i="";for(const[a,n]of Object.entries(e))i+=`\n            <tr>\n                <th>${a}</th>\n                <th>${n}</th>\n            </tr>\n        `;return t.className="smart-table",t.innerHTML=`\n        <h3>${this._smartDeviceId}</h3>\n        <table>\n        ${i}\n        </table>\n    `,t}onMouseButton(e){var t;return e.isDown||(l.IModelApp.notifications.outputMessage(new l.NotifyMessageDetails(l.OutputMessagePriority.Info,`Element ${this._smartDeviceId} clicked`)),null===(t=l.IModelApp.viewManager.selectedView)||void 0===t||t.zoomToElements(this.elementId,{animateFrustumChange:!0,standardViewId:l.StandardViewId.RightIso})),!0}}class SmartDeviceDecorator_SmartDeviceDecorator{constructor(){this.id="SmartDeviceDecorator",this._markerSet=void 0,this._markerSet=[],this.addMarkers()}static async getSmartDeviceData(){const e=h.UiFramework.getIModelConnection().query("SELECT SmartDeviceId, SmartDeviceType, ECInstanceId, Origin \n            FROM DgnCustomItemTypes_HouseSchema.SmartDevice\n            WHERE Origin IS NOT NULL ORDER BY SmartDeviceType"),t=[];for await(const i of e)t.push(i);return t}async addMarkers(){const e=await SmartDeviceDecorator_SmartDeviceDecorator.getSmartDeviceData(),t=await class SmartDeviceAPI{static async getData(){return(await fetch("https://smarthomedata.z22.web.core.windows.net/")).json()}}.getData();e.forEach(e=>{const i=new SmartDeviceMarker_SmartDeviceMarker({x:e.origin.x,y:e.origin.y,z:e.origin.z},{x:20,y:20},e.id,e.smartDeviceId,e.smartDeviceType,t[e.smartDeviceId]);this._markerSet.push(i)})}decorate(e){this._markerSet.forEach(t=>{t.addDecoration(e)})}}var v=i(4);var p=function SmartDeviceWidgetListComponent(){const[e,t]=Object(a.useState)([]);return Object(a.useEffect)(()=>{(async()=>{const e=await SmartDeviceDecorator_SmartDeviceDecorator.getSmartDeviceData(),i={},n=[];e.forEach(e=>{i[e.smartDeviceType]?i[e.smartDeviceType].push(e):i[e.smartDeviceType]=[e]});for(const[t,o]of Object.entries(i))o.forEach((e,t)=>{n.push(a.createElement("tr",{key:e.id},0===t?a.createElement("th",{rowSpan:o.length},e.smartDeviceType):null,a.createElement("th",{onClick:()=>{l.IModelApp.viewManager.selectedView.zoomToElements(e.id,{animateFrustumChange:!0,standardViewId:l.StandardViewId.RightIso})},className:"clickable"},e.smartDeviceId)))});t(n)})()},[]),a.createElement("table",{className:"smart-table"},a.createElement("tbody",null,a.createElement("tr",null,a.createElement("th",null,"Smart Device Type"),a.createElement("th",null,"Smart Device Id")),e))};class SmartDeviceUIItemsProvider_SmartDeviceUIItemsProvider{constructor(){this.id="SmartDeviceUIProvider",this._toggleWalls=!1}provideToolbarButtonItems(e,t,i,a){const n=[];if(t===v.StageUsage.General&&i===v.ToolbarUsage.ContentManipulation&&a===v.ToolbarOrientation.Vertical){const e=v.ToolbarItemUtilities.createActionButton("ToggleWalls",1e3,"icon-element","Toggle Walls Tool",()=>{this._toggleWalls=!this._toggleWalls,Visualization.hideHouseExterior(l.IModelApp.viewManager.selectedView,this._toggleWalls)}),t=v.ToolbarItemUtilities.createActionButton("ToggleMarkers",1e3,"icon-visibility-half","Toggle Markers Tool",()=>{const e=l.IModelApp.viewManager.decorators.find(e=>"SmartDeviceDecorator"===e.id);e?l.IModelApp.viewManager.dropDecorator(e):l.IModelApp.viewManager.addDecorator(new SmartDeviceDecorator_SmartDeviceDecorator)});n.push(e,t)}return n}provideWidgets(e,t,i,a){const o=[];if(i===v.StagePanelLocation.Right){const e={id:"smartDeviceListWidget",label:"Smart Devices",getWidgetContent:()=>n.a.createElement(p,null)};o.push(e)}return o}}var src_App=()=>{const[e,t]=Object(a.useState)(!!d.oidcClient&&d.oidcClient.isAuthorized),[i,o]=Object(a.useState)(!1);Object(a.useEffect)(()=>{(async()=>{d.oidcClient||await d.initializeOidc();try{await d.signInSilent(),t(d.oidcClient.isAuthorized)}catch(e){}})().catch(e=>console.error(e))},[]),Object(a.useEffect)(()=>{},[]),Object(a.useEffect)(()=>{i&&e&&o(!1)},[e,i]);return n.a.createElement("div",{className:"viewer-container"},n.a.createElement(Header,{handleLogin:async()=>{o(!0),await d.signIn()},loggedIn:e,handleLogout:async()=>{o(!1),await d.signOut(),t(!1)}}),i?n.a.createElement("span",null,'"Logging in...."'):e&&n.a.createElement(s.a,{contextId:null!=="867930d2-60bd-436f-9b67-dcb1a6446387"?"867930d2-60bd-436f-9b67-dcb1a6446387":"",iModelId:null!=="7f5de745-9ae7-43c4-ac0f-7bf0a472fbff"?"7f5de745-9ae7-43c4-ac0f-7bf0a472fbff":"",authConfig:{oidcClient:d.oidcClient},onIModelConnected:e=>{console.log("IModel Loaded"),document.title=e.name+" | iTwin Viewer React Sample",l.IModelApp.viewManager.onViewOpen.addOnce(async e=>{e.overrideDisplayStyle({viewflags:{visEdges:!1,shadows:!0}}),Visualization.hideHouseExterior(e),l.IModelApp.viewManager.addDecorator(new SmartDeviceDecorator_SmartDeviceDecorator)})},uiProviders:[new SmartDeviceUIItemsProvider_SmartDeviceUIItemsProvider]}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(n.a.createElement(src_App,null),document.getElementById("root")),function unregister(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()}).catch(e=>{console.error(e.message)})}()},382:function(e,t,i){e.exports={header:"Header_header__2lOTj",buttonContainer:"Header_buttonContainer__1DT-o"}},547:function(e,t){},548:function(e,t){},842:function(e,t){},845:function(e,t){}},[[1312,1,2]]]);
//# sourceMappingURL=main.b68a788f.chunk.js.map